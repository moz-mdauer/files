<script>
  Object.prototype.__defineGetter__("then", function () {
    FuzzingFunctions.garbageCollect();
    FuzzingFunctions.cycleCollect();
  });

  (async () => {
    const response = await (await fetch("http://127.0.0.1:8000/cert.der")).text();
    const certificate = Uint8Array.fromBase64(response);

    let transport = new WebTransport("https://127.0.0.1:4433/wt", {
      serverCertificateHashes: [
        { algorithm: "sha-256", value: certificate.buffer },
      ],
    });
    transport.ready.then((e) => {
      let datagramWriter = transport.datagrams.writable.getWriter();
      datagramWriter.write(new Uint8Array([0x13, 0x37]));

      transport = 0;
    });
  })();
</script>
